$.getJSON("./data/data-normandie.geojson",function(g){var d="sources : "+g.metadata.source+" - "+g.metadata.date;var e="map";var a;var c=new Array;var b={};for(i in fonds){var f=new L.TileLayer(fonds[i].url,{attribution:d+fonds[i].attrib,minZoom:fonds[i].zMin,maxZoom:fonds[i].zMax,unloadInvisibleTiles:true});c[fonds[i].id]=f;b[fonds[i].nom]=f}(function(j){j(function(){setTimeout(function(){if(L){h()}},250)})})(jQuery);function h(){if(document.location.href.match(/carteSeule/g)){e="full";$("#header,#footer,h2").css("display","none");$("#main, #page").css("width","100%");$("#page").css("max-width","none");$("#main, #page").css("margin","0");$("#main, #page").css("padding","0")}$(window).resize(function(){clearTimeout(window.resizedFinished);window.resizedFinished=setTimeout(function(){getWidth(e);$("#map").css("width",rW).css("height",rH)},250)});getWidth(e);$("#map").css("width",rW).css("height",rH);if(knwrmdZoom==null){knwrmdZoom=Math.sqrt(rW)/3.75}carte=L.map("map").setView([knwrmdLat,knwrmdLong],Math.round(knwrmdZoom));for(i in fonds){var j=new L.TileLayer(fonds[i].url,{attribution:d+fonds[i].attrib,minZoom:fonds[i].zMin,maxZoom:fonds[i].zMax,unloadInvisibleTiles:true});c[fonds[i].id]=j;b[fonds[i].nom]=j}if(knwrmdFond==null){knwrmdFond=fonds[0].id}c[knwrmdFond].addTo(carte);var n=new Array;n.Labellisation='<div style="background-color:white;border:1px solid #ddd;opacity:0.8;padding:5px">';n.Avancement='<div style="background-color:white;border:1px solid #ddd;opacity:0.8;padding:5px">';var M=[{id:"caap",icone:"la0-aap",string:"candidat aux appels \u00e0 projet (2009 et 2011)"},{id:"clab",icone:"la1-clab",string:"candidat au label"},{id:"elab",icone:"la2-elab",string:"<i>engag\u00e9</i> dans la d\u00e9marche de labellisation"},{id:"label",icone:"la3-label",string:"projet labellis\u00e9 \u00e9coquartier"},{id:"autres",icone:"la9-autre",string:"autres projets"}];var y=new Array;for(i in M){var s=M[i].icone+".png";y[M[i].id]=L.icon({iconUrl:"./img/"+s,iconRetinaUrl:"./img/"+s,iconSize:[20,38],iconAnchor:[15,38],popupAnchor:[-5,-39],shadowUrl:"./img/la-ombre.png",shadowRetinaUrl:"./img/la-ombre.png",shadowSize:[40,20],shadowAnchor:[0,20]});n.Labellisation+='<img src="./img/'+s+'" style="height:16px"/>&nbsp;'+M[i].string+"<br/>"}n.Labellisation+="</div>";var o=[{id:"abandonn\u00e9",icone:"av0-int",string:"projet abandonn\u00e9"},{id:"suspendu",icone:"av0-int",string:"projet suspendu"},{id:"inconnu",icone:"av0-int",string:"avancement inconnu"},{id:"intention",icone:"av0-int",string:"intention d'\u00e9coquartier"},{id:"projet",icone:"av1-pro",string:"\u00e9coquartier en projet"},{id:"chantier",icone:"av2-chan",string:"\u00e9coquartier en chantier"},{id:"r\u00e9alis\u00e9",icone:"av3-real",string:"\u00e9coquartier r\u00e9alis\u00e9"}];var A=new Array;for(i in o){var s=o[i].icone+".png";A[o[i].id]=L.icon({iconUrl:"./img/"+s,iconRetinaUrl:"./img/"+s,iconSize:[29,37],iconAnchor:[20,37],popupAnchor:[-6,-32],shadowUrl:"./img/av-ombre.png",shadowRetinaUrl:"./img/av-ombre.png",shadowSize:[37,23],shadowAnchor:[0,20]});n.Avancement+='<img src="./img/'+s+'" style="height:20px"/>&nbsp;'+o[i].string+"<br/>"}n.Avancement+="</div>";var C=L.markerClusterGroup({name:"ecoQlabel",maxClusterRadius:function(){return(clusterRadius-50)/9*carte.getZoom()+50-(clusterRadius-50)/9},iconCreateFunction:function(Q){var T=Q.getChildCount();var R=Math.sqrt(T)*carte.getZoom()*carte.getZoom()/250*clusterRadius;if(R<25){R=25}var S=R/2;if(S<12){S=12}return new L.DivIcon({html:'<div style="width:'+R+"px;height:"+R+"px;font-size:"+S+"px;background-color:hsla(270,"+2*Math.sqrt(T)*carte.getZoom()+'%,40%,0.5)"><div><span style="line-height:'+R+'px">'+T+"</span></div></div>",className:"marker-cluster marker-cluster-"+T,iconSize:new L.Point(R,R)})}});C.name="ecoQlabel";var w=L.markerClusterGroup({name:"ecoQavancement",maxClusterRadius:function(){return(clusterRadius-50)/9*carte.getZoom()+50-(clusterRadius-50)/9},iconCreateFunction:function(Q){var T=Q.getChildCount();var R=Math.sqrt(T)*carte.getZoom()*carte.getZoom()/250*clusterRadius;if(R<25){R=25}var S=R/2;if(S<12){S=12}return new L.DivIcon({html:'<div style="width:'+R+"px;height:"+R+"px;font-size:"+S+"px;background-color:hsla(170,"+2*Math.sqrt(T)*carte.getZoom()+'%,40%,0.5)"><div><span style="line-height:'+R+'px">'+T+"</span></div></div>",className:"marker-cluster marker-cluster-"+T,iconSize:new L.Point(R,R)})}});w.name="ecoQavancement";var K=g.features;for(i in K){if(document.location.href.match(/tousProjets/g)||document.location.href.match(/adminView/g)||K[i].properties.Aetat!=="abandonn\u00e9"){var B="<h6>"+K[i].properties.commune+" - "+K[i].properties.name+"</h6>";B+='<i class="avct '+K[i].properties.Aetat+'">'+K[i].properties.Aetat+"</i>";var u=K[i].properties.Isurf,q=K[i].properties.Ilogmt;if(u=="NULL"){}else{B+="<br/>"+u+" ha, "}if(q=="NULL"){}else{B+="<br/>"+q+" logements,"}var t=K[i].properties.Rter,m=K[i].properties.Rtra;if(t=="NULL"){}else{B+="<br/>-&nbsp;<a href="+t+'" target="_blank">internet</a>'}if(m=="NULL"||document.location.href.match(/adminView/g)==null){}else{B+='<span class="intranet"><br/>-&nbsp;<a href="'+m+'" target="_blank">intranet</a></span>'}var H,r;if(!K[i].properties.Lcat||!y[K[i].properties.Lcat]){H=y.autres}else{H=y[K[i].properties.Lcat]}if(!K[i].properties.Aetat||!A[K[i].properties.Aetat]){r=A.inconnu}else{r=A[K[i].properties.Aetat]}var N=(new L.marker([K[i].geometry.coordinates[1],K[i].geometry.coordinates[0]],{icon:H})).bindPopup(B);C.addLayer(N);var v=(new L.marker([K[i].geometry.coordinates[1],K[i].geometry.coordinates[0]],{icon:r})).bindPopup(B);w.addLayer(v)}}var p=L.control({position:"bottomleft"});p.onAdd=function(Q){var R=L.DomUtil.create("div","info legend");R.setAttribute("id","legende");R.innerHTML="";return R};p.addTo(carte);var l={Labellisation:C,Avancement:w};var z=new Array;z.Labellisation=4;z.Avancement=6;var x="vide";if(document.location.href.match(/adminView/g)){var F=function(S){var Q=S.latlng;var R=Q.toString().split("(")[1].split(")")[0];if(E===""){E="Derniers points cliqu\u00e9s :<br/>"}E+=R+";";document.getElementById("listCoord").innerHTML=E;k.setLatLng(Q).setContent("point : "+R).openOn(carte)};var k=L.popup();var E="";carte.on("click",F);carte.on("dblclick",function(){E=""});var D=L.tileLayer.wms("http://georef.application.i2/cartes/mapserv?",{layers:"fonds_nb",format:"image/png",transparent:true,attribution:"&copy; IGN 2014"});c.RgeIgn=D;b["IGN (r\u00e9seau i\u00b2)"]=D;var I=L.control.layers(b);I.addTo(carte);var G=L.control.layers(l);G.addTo(carte);document.getElementById("aide").setAttribute("style","display:block")}else{var J=L.control.layers(l);J.addTo(carte)}function O(Q){document.getElementById("legende").innerHTML=n[Q]}var P=new Array;P.Labellisation=0;P.Avancement=0;carte.on("baselayerchange",function(R){for(var Q in l){if(Q!=R.name&&carte.hasLayer(l[Q])){carte.removeLayer(l[Q])}}x=R.name;O(R.name)});carte.addLayer(C)}});
